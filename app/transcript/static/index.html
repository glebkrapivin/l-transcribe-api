<html>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.6.3.js" type="text/javascript"></script>

<script>

    $.makeTable = function (mydata) {
    var table = $('<table border=1>');
    var tblHeader = "<tr>";
    for (var k in mydata[0]) tblHeader += "<th>" + k + "</th>";
    tblHeader += "</tr>";
    $(tblHeader).appendTo(table);
    $.each(mydata, function (index, value) {
        var TableRow = "<tr>";
        $.each(value, function (key, val) {
            TableRow += "<td>" + val + "</td>";
        });
        TableRow += "</tr>";
        $(table).append(TableRow);
    });
    return ($(table));
};

    $.makeResult = function (mydata) {
    var table = $('<table class="table table-borderless text-center">');
    var tblHeader = "<tr>";


    for (var k of new Array("Filename", "Audio")) tblHeader += "<th>" + k + "</th>";
    tblHeader += "</tr>";
    $(tblHeader).appendTo(table);
    console.log(tblHeader)
    $.each(mydata, function (index, value) {
        var TableRow = "<tr>";

        TableRow += "<td>" + value.filename + "</td>";
        TableRow += "<td>" + "<audio controls src='http://localhost:8000/api/v1/audio/" + value.audio_id+"/raw?start="+ (value.start_at-5) +"?end="+(value.start_at+5)+"'</audio>" + "</td>";
        TableRow += "</tr>";
        $(table).append(TableRow);
    });
    return ($(table));
};
       function get_data($) {
           const url = 'http://localhost:8000/api/v1/analysis';
           var word = $("#wordInput").val();
           var data = {word:word}
            $.get(url, data, function (data) {

                var table2 = $.makeResult(data.items)
                // my table
                $(table2).appendTo("#forTable")
            })
        }

    
    $(document).ready(


        function() {
            $("#searchButton").click(function() {
                $("#forTable").empty()
                get_data($)
                // $("#result").show('slow')
            });

            $("#clearButton").click(function() {
                $("#result").hide('slow')
            });

        }
    )
</script>

<body>
<div class="container pt-5">
    <div class="well">
        <form action="#" method="post">
            <label for="firstname">Enter the word to search for</label>
            <div class="input-group">
                <input type="text" class="form-control" id="wordInput" placeholder="abracadabra" aria-label="Recipient's username"
                       aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <button id="searchButton" class="btn btn-outline-primary" type="button">Search</button>
                    <button id="clearButton" class="btn btn-outline-secondary" type="button">Clear</button>
                </div>
            </div>

        </form>

        <div class="row justify-content-center">
                <div class="table-responsive" id="forTable"></div>
        </div>

        <div id="result" style="display: none">
            <div class="text-center mt-5">
                <h5>
                    Results
                </h5>
            </div>
            <table class="table table-borderless">
                <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>Abracadabra is nice</td>
                    <td>
                        <audio id="blast" controls></audio>
                    </td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>Abracadabra is great</td>
                    <td>
                        <audio id="blast" controls></audio>
                    </td>
                </tr>
                <tr>
                    <th scope="row">3</th>
                    <td>That's what Abracadabra said</td>
                    <td>
                        <audio id="blast" controls></audio>
                    </td>
                </tr>


                </tbody>
            </table>
        </div>


    </div>
</div>
</body>
</html>